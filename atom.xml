<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>柳英伟博客</title>
  
  <subtitle>柳英伟博客</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://marvin9002.github.com/"/>
  <updated>2018-03-31T10:15:35.501Z</updated>
  <id>http://marvin9002.github.com/</id>
  
  <author>
    <name>柳英伟</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>about</title>
    <link href="http://marvin9002.github.com/2018/03/31/about/"/>
    <id>http://marvin9002.github.com/2018/03/31/about/</id>
    <published>2018-03-31T10:15:35.000Z</published>
    <updated>2018-03-31T10:15:35.501Z</updated>
    
    <summary type="html">
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>python +splinter自动刷新抢票</title>
    <link href="http://marvin9002.github.com/2018/03/31/python-splinter%E8%87%AA%E5%8A%A8%E5%88%B7%E6%96%B0%E6%8A%A2%E7%A5%A8/"/>
    <id>http://marvin9002.github.com/2018/03/31/python-splinter自动刷新抢票/</id>
    <published>2018-03-31T09:48:09.000Z</published>
    <updated>2018-03-31T09:53:13.985Z</updated>
    
    <content type="html"><![CDATA[<p>一年一度的春运又来了，</p><p>今年我自己写了个抢票脚本。</p><p>python +splinter自动刷新抢票，可以成功抢到（依赖自己的网络环境太厉害，还有机器的好坏），</p><p>但是感觉不是很完美!</p><a id="more"></a><p>有大神请指导完善一下（或者有没有别的好点的思路）</p><p>不胜感谢</p><p>废话不多说，代码帅上来!</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">@author: liuyw</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">from splinter.browser import Browser</span><br><span class="line">from time import sleep</span><br><span class="line">import traceback</span><br><span class="line">import time, sys</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class huoche(object):</span><br><span class="line">&quot;&quot;&quot;docstring for huoche&quot;&quot;&quot;</span><br><span class="line">driver_name=&apos;&apos;</span><br><span class="line">executable_path=&apos;&apos;</span><br><span class="line">#用户名，密码</span><br><span class="line">username = u&quot;xxx@qq.com&quot;</span><br><span class="line">passwd = u&quot;xxxx&quot;</span><br><span class="line"># cookies值得自己去找, 下面两个分别是上海, 太原南</span><br><span class="line">starts = u&quot;%u4E0A%u6D77%2CSHH&quot;</span><br><span class="line">ends = u&quot;%u592A%u539F%2CTYV&quot;</span><br><span class="line"># 时间格式2018-01-19</span><br><span class="line">dtime = u&quot;2018-01-19&quot;</span><br><span class="line"># 车次，选择第几趟，0则从上之下依次点击</span><br><span class="line">order = 0</span><br><span class="line">###乘客名</span><br><span class="line">users = [u&quot;xxx&quot;,u&quot;xxx&quot;]</span><br><span class="line">##席位</span><br><span class="line">xb = u&quot;二等座&quot;</span><br><span class="line">pz=u&quot;成人票&quot;</span><br><span class="line"></span><br><span class="line">&quot;&quot;&quot;网址&quot;&quot;&quot;</span><br><span class="line">ticket_url = &quot;https://kyfw.12306.cn/otn/leftTicket/init&quot;</span><br><span class="line">login_url = &quot;https://kyfw.12306.cn/otn/login/init&quot;</span><br><span class="line">initmy_url = &quot;https://kyfw.12306.cn/otn/index/initMy12306&quot;</span><br><span class="line">buy=&quot;https://kyfw.12306.cn/otn/confirmPassenger/initDc&quot;</span><br><span class="line">login_url=&apos;https://kyfw.12306.cn/otn/login/init&apos;</span><br><span class="line">def __init__(self):</span><br><span class="line">self.driver_name=&apos;chrome&apos;</span><br><span class="line">self.executable_path=&apos;/usr/local/bin/chromedriver&apos;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def login(self):</span><br><span class="line">self.driver.visit(self.login_url)</span><br><span class="line">self.driver.fill(&quot;loginUserDTO.user_name&quot;, self.username)</span><br><span class="line"># sleep(1)</span><br><span class="line">self.driver.fill(&quot;userDTO.password&quot;, self.passwd)</span><br><span class="line">print u&quot;等待验证码，自行输入...&quot;</span><br><span class="line">while True:</span><br><span class="line">if self.driver.url != self.initmy_url:</span><br><span class="line">sleep(1)</span><br><span class="line">else:</span><br><span class="line">break</span><br><span class="line"></span><br><span class="line">def start(self):</span><br><span class="line">self.driver=Browser(driver_name=self.driver_name,executable_path=self.executable_path)</span><br><span class="line">self.driver.driver.set_window_size(1400, 1000)</span><br><span class="line">self.login()</span><br><span class="line"># sleep(1)</span><br><span class="line">self.driver.visit(self.ticket_url)</span><br><span class="line">try:</span><br><span class="line">print u&quot;购票页面开始...&quot;</span><br><span class="line"># sleep(1)</span><br><span class="line"># 加载查询信息</span><br><span class="line">self.driver.cookies.add(&#123;&quot;_jc_save_fromStation&quot;: self.starts&#125;)</span><br><span class="line">self.driver.cookies.add(&#123;&quot;_jc_save_toStation&quot;: self.ends&#125;)</span><br><span class="line">self.driver.cookies.add(&#123;&quot;_jc_save_fromDate&quot;: self.dtime&#125;)</span><br><span class="line"></span><br><span class="line">self.driver.reload()</span><br><span class="line"></span><br><span class="line">count=0</span><br><span class="line">if self.order!=0:</span><br><span class="line">while self.driver.url==self.ticket_url:</span><br><span class="line">self.driver.find_by_text(u&quot;查询&quot;).click()</span><br><span class="line">count += 1</span><br><span class="line">print u&quot;循环点击查询... 第 %s 次&quot; % count</span><br><span class="line"># sleep(1)</span><br><span class="line">try:</span><br><span class="line">self.driver.find_by_text(u&quot;预订&quot;)[self.order - 1].click()</span><br><span class="line">except Exception as e:</span><br><span class="line">print e</span><br><span class="line">print u&quot;还没开始预订&quot;</span><br><span class="line">continue</span><br><span class="line">else:</span><br><span class="line">while self.driver.url == self.ticket_url:</span><br><span class="line">self.driver.find_by_text(u&quot;查询&quot;).click()</span><br><span class="line">count += 1</span><br><span class="line">print u&quot;循环点击查询... 第 %s 次&quot; % count</span><br><span class="line"># sleep(0.8)</span><br><span class="line">try:</span><br><span class="line">for i in self.driver.find_by_text(u&quot;预订&quot;):</span><br><span class="line">i.click()</span><br><span class="line">sleep(1)</span><br><span class="line">except Exception as e:</span><br><span class="line">print e</span><br><span class="line">print u&quot;还没开始预订 %s&quot; %count</span><br><span class="line">continue</span><br><span class="line">print u&quot;开始预订...&quot;</span><br><span class="line"># sleep(3)</span><br><span class="line"># self.driver.reload()</span><br><span class="line">sleep(1)</span><br><span class="line">print u&apos;开始选择用户...&apos;</span><br><span class="line">for user in self.users:</span><br><span class="line">self.driver.find_by_text(user).last.click()</span><br><span class="line"></span><br><span class="line">print u&quot;提交订单...&quot;</span><br><span class="line">sleep(1)</span><br><span class="line"># self.driver.find_by_text(self.pz).click()</span><br><span class="line"># self.driver.find_by_id(&apos;&apos;).select(self.pz)</span><br><span class="line"># # sleep(1)</span><br><span class="line"># self.driver.find_by_text(self.xb).click()</span><br><span class="line"># sleep(1)</span><br><span class="line">self.driver.find_by_id(&apos;submitOrder_id&apos;).click()</span><br><span class="line"># print u&quot;开始选座...&quot;</span><br><span class="line"># self.driver.find_by_id(&apos;1D&apos;).last.click()</span><br><span class="line"># self.driver.find_by_id(&apos;1F&apos;).last.click()</span><br><span class="line"></span><br><span class="line">sleep(1.5)</span><br><span class="line">print u&quot;确认选座...&quot;</span><br><span class="line">self.driver.find_by_id(&apos;qr_submit_id&apos;).click()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">except Exception as e:</span><br><span class="line">print e</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ == &apos;__main__&apos;:</span><br><span class="line">huoche=huoche()</span><br><span class="line">huoche.start()</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      一年一度的春运又来了，今年我自己写了个抢票脚本。python +splinter自动刷新抢票，可以成功抢到（依赖自己的网络环境太厉害，还有机器的好坏），但是感觉不是很完美，有大神请指导完善一下（或者有没有别的好点的思路）不胜感谢
    
    </summary>
    
      <category term="后端" scheme="http://marvin9002.github.com/categories/%E5%90%8E%E7%AB%AF/"/>
    
    
      <category term="python" scheme="http://marvin9002.github.com/tags/python/"/>
    
      <category term="splinter" scheme="http://marvin9002.github.com/tags/splinter/"/>
    
      <category term="火车票" scheme="http://marvin9002.github.com/tags/%E7%81%AB%E8%BD%A6%E7%A5%A8/"/>
    
  </entry>
  
  <entry>
    <title>PHP高效导出Excel(CSV)</title>
    <link href="http://marvin9002.github.com/2018/03/31/PHP%E9%AB%98%E6%95%88%E5%AF%BC%E5%87%BAExcel-CSV/"/>
    <id>http://marvin9002.github.com/2018/03/31/PHP高效导出Excel-CSV/</id>
    <published>2018-03-31T09:04:05.000Z</published>
    <updated>2018-03-31T10:14:58.890Z</updated>
    
    <content type="html"><![CDATA[<p>CSV，是Comma Separated Value（逗号分隔值）的英文缩写，通常都是纯文本文件。<br>如果你导出的Excel没有什么高级用法的话，只是做导出数据用那么建议使用本方法,要比PHPexcel要高效的多。<br>二十万数据导出大概需要2到3秒。</p><a id="more"></a><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"> /**</span><br><span class="line"> * 导出excel(csv)</span><br><span class="line"> * @data 导出数据</span><br><span class="line"> * @headlist 第一行,列名</span><br><span class="line"> * @fileName 输出Excel文件名</span><br><span class="line"> */</span><br><span class="line">function csv_export($data = array(), $headlist = array(), $fileName) &#123;</span><br><span class="line">  </span><br><span class="line">    header(&apos;Content-Type: application/vnd.ms-excel&apos;);</span><br><span class="line">    header(&apos;Content-Disposition: attachment;filename=&quot;&apos;.$fileName.&apos;.csv&quot;&apos;);</span><br><span class="line">    header(&apos;Cache-Control: max-age=0&apos;);</span><br><span class="line">  </span><br><span class="line">    //打开PHP文件句柄,php://output 表示直接输出到浏览器</span><br><span class="line">    $fp = fopen(&apos;php://output&apos;, &apos;a&apos;);</span><br><span class="line">    </span><br><span class="line">    //输出Excel列名信息</span><br><span class="line">    foreach ($headlist as $key =&gt; $value) &#123;</span><br><span class="line">        //CSV的Excel支持GBK编码，一定要转换，否则乱码</span><br><span class="line">        $headlist[$key] = iconv(&apos;utf-8&apos;, &apos;gbk&apos;, $value);</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    //将数据通过fputcsv写到文件句柄</span><br><span class="line">    fputcsv($fp, $headlist);</span><br><span class="line">    </span><br><span class="line">    //计数器</span><br><span class="line">    $num = 0;</span><br><span class="line">    </span><br><span class="line">    //每隔$limit行，刷新一下输出buffer，不要太大，也不要太小</span><br><span class="line">    $limit = 100000;</span><br><span class="line">    </span><br><span class="line">    //逐行取出数据，不浪费内存</span><br><span class="line">    $count = count($data);</span><br><span class="line">    for ($i = 0; $i &lt; $count; $i++) &#123;</span><br><span class="line">    </span><br><span class="line">        $num++;</span><br><span class="line">        </span><br><span class="line">        //刷新一下输出buffer，防止由于数据过多造成问题</span><br><span class="line">        if ($limit == $num) &#123; </span><br><span class="line">            ob_flush();</span><br><span class="line">            flush();</span><br><span class="line">            $num = 0;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        $row = $data[$i];</span><br><span class="line">        foreach ($row as $key =&gt; $value) &#123;</span><br><span class="line">            $row[$key] = iconv(&apos;utf-8&apos;, &apos;gbk&apos;, $value);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        fputcsv($fp, $row);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      CSV，是Comma Separated Value（逗号分隔值）的英文缩写，通常都是纯文本文件。
    
    </summary>
    
      <category term="后端" scheme="http://marvin9002.github.com/categories/%E5%90%8E%E7%AB%AF/"/>
    
    
      <category term="PHP" scheme="http://marvin9002.github.com/tags/PHP/"/>
    
      <category term="CSV" scheme="http://marvin9002.github.com/tags/CSV/"/>
    
  </entry>
  
</feed>
